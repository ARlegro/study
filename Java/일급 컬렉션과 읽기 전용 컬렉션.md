ê°ì²´ ì§€í–¥ ìƒí™œ ì²´ì¡° ì›ì¹™ ì¤‘ â€˜ì¼ê¸‰ ì»¬ë ‰ì…˜ ì‚¬ìš©â€™ ì›ì¹™ì´ ìˆë‹¤.

ì´ ê¸€ì€ ì´ ì›ì¹™ì„ ì ìš©í•˜ë©´ì„œ ê³µë¶€í•œ ë‚´ìš©ì´ë‹¤.

## **ê´€ì‹¬ ê³„ê¸° : ì™œ ì“°ê²Œ ëëŠ”ê°€???**

í”„ë¡œì íŠ¸ë¥¼ í•˜ë©´ì„œ spring-batch ì‘ì—…ì„ ë‹´ë‹¹í•˜ê³  ìˆì—ˆë‹¤.<br>
ë©€í‹°ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ 4ê°œì˜ Threadê°€ ê°ê° ì™¸ë¶€ APIë¥¼ í˜¸ì¶œí•˜ëŠ” Flowë¥¼ ì§œê³  ê°ê° ê°€ì ¸ì˜¨ ë°ì´í„°ë¥¼ ë°°ì¹˜ì˜ ExecutionContextì— ë‹´ì•„ì„œ ê³µìœ í•˜ëŠ” ê³¼ì •ì—ì„œ ë‹¨ìˆœíˆ ì»¬ë ‰ì…˜ì„ ë‹´ìœ¼ë©´ ìœ„í—˜í•  ê²ƒ ê°™ë‹¤ëŠ” ìƒê°ì´ ë“¤ì—ˆë‹¤.
<br>
ë˜í•œ, í•´ë‹¹ ì»¬ë ‰ì…˜ì„ ì´ìš©í•œ ê´€ë ¨ ë¹„ì¦ˆë‹ˆ ë¡œì§ì´ ê²¹ì¹˜ê¸° ë•Œë¬¸ì— ì¢€ ë” ê°ì²´ ì§€í–¥ìŠ¤ëŸ½ê²Œ ì½”ë“œë¥¼ ë³€ê²½í•˜ê³  ì‹¶ì—ˆë‹¤.
<br>
ì°¸ê³  : ì•„ë˜ì˜ ì‚¬ì§„ì€ ë‚´ê°€ ì§œê³  ìˆëŠ” ì½”ë“œì˜ ì „ë°˜ì ì¸ íë¦„ì´ë‹¤.
![image.png](attachment:5593ac5b-be20-43f5-82c9-c8bf3294fcab:image.png)


ê° ìŠ¤ë ˆë“œê°€ ì™¸ë¶€ ApiStepì´ ExecutionContextì˜ ìë£Œë¥¼ ì´ìš©í•˜ëŠ” ìƒí™©

## ì¼ê¸‰ ì»¬ë ‰ì…˜(First-Class Collection)

### âœ… ê°œë…

- Collection(ex. List, Set, Map ë“±)ì„ Wrappingí•˜ë©´ì„œ ê·¸ Collection ì™¸ ë‹¤ë¥¸ í•„ë“œê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” êµ¬ì¡°ë¥¼ ì˜ë¯¸í•œë‹¤.

```java
public class Orders {
    private final List<Order> orders;

    public Orders(List<Order> orders) {
        // this.orders = new ArrayList<>(orders); // ë°©ì–´ì  ë³µì‚¬ ì˜ˆì‹œì¸ë° ë’¤ì—ì„œ 
        this.orders = orders;
    }

    public void add(Order order) {
        orders.add(order);
    }

    public List<Order> getOrders() {
        return Collections.unmodifiableList(orders); // ë¶ˆë³€ ë³´ì¥
    }
}
```

### **âœ… íš¨ê³¼**

ì»¬ë ‰ì…˜ì„ êµ³ì´ ì™œ Wrappingí• ê¹Œ???

1ï¸âƒ£ SRP ì¤€ìˆ˜

- í•´ë‹¹ ì»¬ë ‰ì…˜ ìì²´ì— ëŒ€í•œ ì±…ì„ê³¼ ë„ë©”ì¸ ë¡œì§ì„ í•œ ê°ì²´ì— ëª½ì•„ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤.
- ì˜ˆë¥¼ ë“¤ì–´, Ordersë“¤ì˜ ê°€ê²©ì˜ í•©ì„ êµ¬í•˜ëŠ” ë¡œì§ì„ ë§Œë“ ë‹¤ê³  í•  ë–„, Ordersë¥¼ ì‚¬ìš©í•˜ëŠ” ê³³ì—ì„œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë§Œë“œëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ì¼ê¸‰ ì»¬ë ‰ì…˜ì— ë”°ë¡œ ë¹„ì¦ˆë‹ˆìŠ¤ ë©”ì„œë“œë¥¼ ë§Œë“¤ì–´ ìº¡ìŠí™” ë° SRP ì›ì¹™ì„ ê°•í™œ ìˆ˜ ìˆë‹¤.

2ï¸âƒ£ ë¶ˆë³€ì„± ìœ ì§€

ê°„í˜¹ collectioníƒ€ì…ì— finalì„ ê±¸ì–´ ë†“ìœ¼ë©´ ë‚´ë¶€ê°’ë„ ë¶ˆë³€í•œë‹¤ê³  ì˜¤í•´í•˜ëŠ” ì‚¬ëŒì´ ìˆì§€ë§Œ ê·¸ê±´ ì˜ëª»ëë‹¤.

ì•„ë˜ì˜ ì½”ë“œë¥¼ ì˜ˆì‹œë¡œ ë³´ì

```java
@Getter 
public class Orders {

  private final List<Order> orders;

//******************************
  List<Order> orders = orders.getOrders();
  orders.clear();
}
```

- ê³¼ì—° ìœ„ì˜ ì½”ë“œê°€ clearê°€ ë ê¹Œ?? Yes
- orders í´ë˜ìŠ¤ì˜ orders ë³€ìˆ˜ë¥¼ êº¼ë‚´ì„œ ì™¸ë¶€ì—ì„œ clearë¥¼ í•  ìˆ˜ ìˆë‹¤.

  > ì¦‰, ë‹¨ìˆœíˆ finalë¡œ ì„ ì–¸ë˜ë”ë¼ë„ ë‚´ë¶€ ìš”ì†ŒëŠ” ë°”ë€” ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì´ë‹¤.

- ë§Œì•½, ì´ ordersë¡œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ë§Œ í•´ì•¼í•˜ëŠ”ë°, ì‹¤ìˆ˜ë¡œ ì˜¬ë°”ë¥´ì§€ ì•Šì€ ì½”ë“œë¥¼ ì‘ì„±í•˜ë©´ ì´ëŠ” í° ì‚¬ê³ ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆë‹¤.


- âœ… ê°„ë‹¨í•œ í•´ê²°

  ì´ë¥¼ í•´ê²°í•˜ëŠ” ì—¬ëŸ¬ ë°©ë²•ë“¤ ì¤‘ ê°€ì¥ ê°„ë‹¨í•œ ë°©ë²•ì€ Getterë¥¼ ì—†ì• ê³  ì™¸ë¶€ì—ì„œ ë©”ì„œë“œë¡œë§Œ ì ‘ê·¼í•˜ë„ë¡ í•˜ëŠ” ë°©ë²•ì´ ìˆë‹¤. ì•„ë˜ì˜ ì˜ˆì‹œë¥¼ ë³´ì

    ```java
    public class Orders {
      private final List<Order> orders;
      
      public Orders(List<Order> orders){
    		 this.orders = orders;
      }
    ```

  ìœ„ì˜ ì½”ë“œì—ì„œ ì™¸ë¶€ì—ì„œ ordersë¥¼ ì ‘ê·¼í•˜ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼í• ê¹Œ???

  ëª»í•œë‹¤. ì´ë ‡ê²Œ ìº¡ìŠí™”ë¥¼ ì‹œì¼œë†“ìŒìœ¼ë¡œì¨ ì™¸ë¶€ì—ì„œ í•¨ë¶€ë¡œ Collectionì„ ë³€ê²½í•˜ëŠ” ê²ƒì„ ë§‰ì•„ ì•ˆì •ì„±ì„ í™•ë³´í•  ìˆ˜ ìˆë‹¤. ë§Œì•½ ì¶”ê°€, ì œê±° ë¡œì§ì´ í•„ìš”í•˜ë©´ Orders í´ë˜ìŠ¤ì— ë”°ë¡œ ë©”ì„œë“œë¥¼ ë§Œë“¤ë©´ ë¨ (ì´ê±´ 3ë²ˆ ë‚´ìš©)


<aside>
ğŸ’¡

**ë²ˆì™¸ : ì¶”ê°€ í•´ê²°ë²•**

ì´ëŸ¬í•œ í•´ê²°ë°©ë²• ë§ê³  ë’¤ì—ì„œ ë°°ìš¸ unmodifiableCollection í˜¹ì€ ë°©ì–´ì  ë³µì‚¬ë¥¼ í•  ìˆ˜ ìˆëŠ”ë° ìì„¸í•œê±´ ë‚˜ì¤‘ì—

</aside>

**3ï¸âƒ£ ìƒíƒœì™€ í–‰ìœ„ë¥¼ í•œ ê³³ì—ì„œ ê´€ë¦¬**

ì—„ì²­ë‚œ ì¥ì  ì¤‘ í•˜ë‚˜ì´ë‹¤. (1ë²ˆê³¼ ì–¼ì¶” ë¹„ìŠ·í•œ ë‚´ìš©ì´ë‹¤)

ì¼ê¸‰ ì»¬ë ‰ì…˜ì„ ë§Œë“¤ë©´ ë°ì´í„°ì™€ ë¡œì§ì´ ë™ì‹œì— ì¡´ì¬í•˜ëŠ” í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

ì•„ë˜ì˜ ì½”ë“œì²˜ëŸ¼ ì»¬ë ‰ì…˜ì˜ ê°’ê³¼ ê·¸ ì»¬ë ‰ì…˜ì„ ì´ìš©í•´ì„œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì§œëŠ” í´ë˜ìŠ¤ë¥¼ ë§í•˜ëŠ” ê²ƒì´ë‹¤.

```java
public class Orders {
  private final List<Order> orders;

  public Orders(List<Order> orders) {
    this.orders = orders;
  }

	// ì™¸ë¶€ì—ì„œ List<Order>ì— orderë¥¼ ì¶”ê°€í•˜ê³  ì‹¶ì„ ì‹œ   
  public void addOrder(Order order) {
    orders.add(order);
  }
  
	// ì™¸ë¶€ì—ì„œ ëª¨ë“  Orderì˜ ê°€ê²©ì„ í•©í•˜ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ìˆ˜í–‰ 
  public int getTotalPrice() {
    int sum = 0;
    for (Order order : orders) {
      sum += order.getPrice();
    }
    return sum;
  }

```

ì•„ë˜ëŠ” ë‚´ê°€ í”„ë¡œì íŠ¸ë¥¼ í•˜ë©´ì„œ ë§Œë“¤ê³  ìˆëŠ” ì¼ê¸‰ ì»¬ë ‰ì…˜

```java
@Getter
public class Keywords {

  private final List<String> keywords;

  public Keywords(List<String> keywords) {
    this.keywords = Collections.unmodifiableList(keywords);
  }

  // O(N2)ì¸ë°... ë‚˜ì¤‘ì— Hash êµ¬ì¡°ë¡œ ë‹¤ ë°”ê¿”ì•¼í•  ê²ƒ ê°™ë„¤
  public List<ArticleApiDto> filter(List<ArticleApiDto> articleApiDtos) {
    return articleApiDtos.stream()
        .filter(this::isContainsIn)
        .toList();
  }

  public boolean isContainsIn(ArticleApiDto articleApiDto) {
    String summary = articleApiDto.summary();
    //summary.toLowerCase();
    return keywords.stream()
        .anyMatch(summary::contains);
  }
```

## ì¼ê¸‰ ì»¬ë ‰ì…˜ ì•ˆì „í•˜ê²Œ ì‚¬ìš©í•˜ê¸°

### 1. ë©€í‹°ìŠ¤ë ˆë“œ í™˜ê²½ - ë°©ì–´ì  ë³µì‚¬, ë‚´ë¶€ì—ì„œ êµ¬í˜„

ë©€í‹°ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ ìƒê¸°ëŠ” ë¬¸ì œê°€ ìˆë‹¤.

ì•„ë˜ì˜ ì½”ë“œë¥¼ ë³´ê³  ë©€í‹°ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ ì–´ë–¤ ë¬¸ì œê°€ ìˆì„ê¹Œ??

```java
**[ë©€í‹°ìŠ¤ë ˆë“œì¼ ê²½ìš°]**
public class Orders {

  private final List<Order> orders;

  public Orders(List<Order> orders) {
    validateOrderPrice();
    this.orders = orders;
  }

  // ê²€ì¦ë¡œì§ 
  public void validateOrderPrice() {

  }
}
```

âœ… **ìƒí™©**

- ì™¸ë¶€ì—ì„œ List<Order>ë¥¼ ë§Œë“¤ê³  ìƒì„±ìì— ë„£ê¸°
- ì»¬ë ‰ì…˜ ë‚´ë¶€ì˜ ì†ì„±ë“¤ì„ ê²€ì¦
- ê²€ì¦ ì™„ë£Œ ì‹œ ë„£ê¸°

**ğŸ’¢ ë©€í‹° ìŠ¤ë ˆë“œì—ì„œëŠ” ë¬¸ì œ ë°œìƒ**

- validateOrderPriceí•˜ëŠ” ì™€ì¤‘ì— ì™¸ë¶€ì—ì„œ ordersê°’ì„ ë³€ê²½ì‹œí‚¨ë‹¤ë©´??
- ê²€ì¦ì´ ì œëŒ€ë¡œ ì•ˆëœ ê°’ì´ ë“¤ì–´ê°€ ë²„ë¦´ ìˆ˜ ìˆë‹¤.

**â˜‘ï¸ í•´ê²°ë°©ë²• 1. ë°©ì–´ì  ë³µì‚¬**

```java
**[ë©€í‹°ìŠ¤ë ˆë“œì¼ ê²½ìš°]**
public class Orders {
  private final List<Order> orders;

  public Orders(List<Order> orders) {
	  List<Order> copyOrders = new ArrayList<>(orders);
	  validateOrderPrice();
    this.orders = orders;
  }
```

ìœ„ì˜ ì½”ë“œì—ì„œ ì™¸ë¶€ì—ì„œ ì£¼ì…í•œ ordersì™€ copyOrdersëŠ” ë‹¤ë¥¸ ì°¸ì¡°ê°’ì„ ê°€ì§€ê²Œ ëœë‹¤.

ì´ë ‡ê²Œ ë˜ë©´, ê²€ì¦ ë¡œì§ì´ ì§„í–‰ë  ë–„, ì™¸ë¶€ì—ì„œ ì£¼ì…í•œ ordersê°€ ë³€ê²½ë˜ë”ë¼ë„ ì „í˜€ ë¬¸ì œê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤.

**â˜‘ï¸ í•´ê²°ë°©ë²• 2. Order ìƒì„±ë¡œì§ì„ ë‚´ë¶€ì—ì„œ**

```java
public class Orders {
  private final List<Order> orders;

  public Orders(List<String> names) {
	  List<String> copyNames = new ArrayList<>(names);
	  validateDuplicatedName();
	  
    this.orders = copyNames.stream()
                .map(carName -> new Car(carName))
                .toList;
  }
```

### 2. ì½ê¸° ì „ìš© ì»¬ë ‰ì…˜ìœ¼ë¡œ ë³€ê²½

ìë°”ì—ì„œëŠ” Collectionì„ ë³€ê²½í•  ìˆ˜ ì—†ê²Œ ë§Œë“œëŠ” ìœ í‹¸ì´ ìˆë‹¤.

ë°”ë¡œ `Collections.unmodifiable~~~`ì´ë‹¤.

ì´ê²ƒì„ ì‚¬ìš©í•˜ë©´ ì´ ì»¬ë ‰ì…˜ì€ ì½ê¸°ë§Œ ê°€ëŠ¥í•œ ì½ê¸° ì „ìš© ì»¬ë ‰ì…˜ì´ ë˜ì–´, ê°ì²´ì˜ ì°¸ì¡°ê°’ì„ ì•Œì•„ë„ ë‚´ë¶€ë¥¼ ì „í˜€ ë°”ë€” ìˆ˜ ì—†ë‹¤.

```java
public class Keywords {

  private final List<String> keywords;

  public Keywords(List<String> keywords) {
    this.keywords = Collections.unmodifiableList(keywords);
    //Collections.unmodifiableMap()
  }
```